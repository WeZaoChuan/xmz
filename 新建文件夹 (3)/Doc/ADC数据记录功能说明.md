# ADC数据记录功能使用说明

## 功能概述

本功能实现了按键控制的ADC数据采集、存储和读取功能，支持将ADC数据和时间戳存储到SD卡，并可通过串口打印查看。

## 功能特性

- **按键5（USER_BUTTON_4）**：开始ADC数据记录
- **按键6（USER_BUTTON_5）**：停止记录并从SD卡读取打印数据
- **自动保存**：当数据缓冲区满时自动保存到SD卡
- **GB2312编码**：串口输出使用中文字符
- **时间戳记录**：每条ADC数据都包含精确的时间戳

## 数据结构

```c
typedef struct {
    uint32_t timestamp;  // 时间戳（毫秒）
    uint32_t adc_value;  // ADC原始值
    float voltage;       // 电压值
} AdcDataRecord;
```

## 使用方法

### 1. 开始数据记录
- 按下**按键5**（对应GPIO PE7）
- 系统开始记录ADC数据和时间戳
- LED4状态会切换，表示操作成功
- 串口输出："开始ADC数据记录..."

### 2. 查看和停止记录
- 按下**按键6**（对应GPIO PB0）
- 如果正在记录，系统会自动停止记录并保存数据到SD卡
- 然后从SD卡读取数据并通过串口打印
- LED5状态会切换，表示操作成功

### 3. 数据输出格式
```
=== ADC数据记录 (共XXX条) ===
时间戳：1234567，ADC值：2048
时间戳：1234667，ADC值：2050
...
=== 数据打印完成 ===
```

## 技术参数

- **最大记录数量**：1000条
- **采样周期**：1ms（由调度器控制）
- **采样频率**：1000Hz
- **存储位置**：SD卡 DATA/adc_records.dat
- **数据格式**：二进制结构体数组
- **时间戳精度**：1ms

## 工作流程

1. **数据采集**：adc_task每1ms执行一次，直接从ADC DMA缓冲区读取数据
2. **数据记录**：当adc_record_flag为1时，每1ms记录一次时间戳和ADC值
3. **实时采样**：不依赖DMA完成标志，确保严格的1ms间隔记录
4. **自动保存**：缓冲区满时自动保存到SD卡
5. **手动操作**：通过按键控制开始记录和读取打印

## 注意事项

1. **SD卡要求**：确保SD卡已正确初始化并挂载
2. **存储空间**：每条记录占用12字节，1000条记录约12KB
3. **数据覆盖**：新的记录会覆盖之前的数据文件
4. **串口波特率**：确保串口工具设置正确的波特率
5. **编码设置**：串口工具需要支持GB2312编码以正确显示中文
6. **采样时间**：1000条记录在1ms间隔下需要1秒完成
7. **系统负载**：1ms高频采样会增加系统负载，注意其他任务的响应时间

## 错误处理

- **SD卡未初始化**：会显示相应错误信息
- **存储失败**：会提示"ADC数据保存失败"
- **读取失败**：会提示"读取ADC数据文件失败"
- **无数据**：会提示"没有找到ADC数据记录"

## 扩展功能

可以根据需要扩展以下功能：
- 调整采样频率
- 增加数据过滤
- 支持多种数据格式导出
- 添加数据统计分析
- 实现数据压缩存储
