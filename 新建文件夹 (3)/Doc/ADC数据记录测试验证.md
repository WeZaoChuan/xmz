# ADC数据记录功能测试验证

## 测试环境准备

### 硬件要求
- STM32F4系列开发板
- SD卡（已格式化为FAT32）
- 串口调试工具
- 按键5（GPIO PE7）和按键6（GPIO PB0）

### 软件要求
- 串口工具支持GB2312编码
- 波特率设置正确（通常为115200）

## 测试步骤

### 1. 系统初始化测试
**操作**：上电启动系统
**预期结果**：
```
SD卡挂载成功
可用簇数: XXXX
创建数据目录成功
```

### 2. ADC数据记录测试
**操作**：按下按键5（物理按键5，GPIO PE7）
**预期结果**：
- LED4状态改变
- 串口输出："开始ADC数据记录..."
- 系统开始每20ms记录一次ADC数据

### 3. 数据读取和打印测试
**操作**：按下按键6（物理按键6，GPIO PB0）
**预期结果**：
- LED5状态改变
- 如果正在记录，显示："停止ADC数据记录，共记录XXX条数据"
- 显示："ADC数据已保存到SD卡，共XXX条记录"
- 显示数据列表：
```
=== ADC数据记录 (共XXX条) ===
时间戳：1234567，ADC值：2048
时间戳：1234667，ADC值：2050
...
=== 数据打印完成 ===
```

### 4. 缓冲区满测试
**操作**：长时间记录（超过1000条记录）
**预期结果**：
- 当记录满1000条时自动停止
- 显示："ADC数据记录已满，共记录1000条数据，正在保存到SD卡..."
- 自动保存到SD卡

### 5. 重复测试
**操作**：多次执行记录和读取操作
**预期结果**：
- 新记录会覆盖旧记录
- 每次操作都能正常工作

## 故障排除

### 问题1：SD卡挂载失败
**可能原因**：
- SD卡未插入或接触不良
- SD卡格式不正确
- SD卡损坏

**解决方法**：
- 检查SD卡连接
- 重新格式化SD卡为FAT32
- 更换SD卡

### 问题2：按键无响应
**可能原因**：
- 按键硬件故障
- GPIO配置错误
- 按键去抖动时间设置问题

**解决方法**：
- 检查按键硬件连接
- 验证GPIO配置
- 调整去抖动参数

### 问题3：串口输出乱码
**可能原因**：
- 波特率设置错误
- 编码设置错误

**解决方法**：
- 检查串口波特率设置
- 设置串口工具为GB2312编码

### 问题4：数据保存失败
**可能原因**：
- SD卡空间不足
- 文件系统错误
- SD卡写保护

**解决方法**：
- 清理SD卡空间
- 重新格式化SD卡
- 检查写保护开关

## 性能验证

### 数据完整性
- 验证时间戳递增
- 验证ADC值在合理范围内
- 验证记录数量正确

### 时间精度
- 验证时间戳间隔约为20ms
- 验证时间戳单调递增

### 存储效率
- 验证文件大小 = 记录数量 × 12字节
- 验证读写速度满足要求

## 测试记录表

| 测试项目 | 测试时间 | 测试结果 | 备注 |
|---------|---------|---------|------|
| 系统初始化 | | □通过 □失败 | |
| 开始记录 | | □通过 □失败 | |
| 停止记录 | | □通过 □失败 | |
| 数据打印 | | □通过 □失败 | |
| 缓冲区满 | | □通过 □失败 | |
| 重复操作 | | □通过 □失败 | |

## 验收标准

✅ 按键响应正常
✅ LED状态正确切换
✅ 串口输出信息完整
✅ 数据保存成功
✅ 数据读取正确
✅ 时间戳格式正确
✅ ADC值在合理范围
✅ 中文显示正常
✅ 系统稳定运行
